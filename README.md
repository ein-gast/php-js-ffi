# Этот репозиторий кода к статье "Единый код валидаторов на фонте и бэке (PHP + FFI + Go + JS)"

Главный тезис стати: возможно использовать идею "единый код валидаторов для фронта и бэка", 
имея исходный код фронта на js, а бэк не на node.

В проекте пять папок, назначение каждой из них:

 - **01-prepare-php** - собирает расширение ffi и zip для php;
 - **02-prepare-golang** - собирает библиотеку runjs.so;
 - **03-php-ffi-test** - проводит простой тест вызова runjs.so из php;
 - **04-run-demo** - здесь полноценное приложение на php+Laravel с исследуемым валидатором;
 - **layers** - здесь хранятся собранные файлы: расширение ffi и библиотека runjs.so.

## TL;DR

```bash
make setup
make up
```

Открываем http://127.8.0.1:8000

## Подробнее про запуск

Для сборки компонентов нужен `docker` для старта Laravel - `docker compose`. Ещё нужна команда `make` и `sh`.

Как пользоваться. Сначала собираем зависимоти командой `make setup`, потом смотрим в `./04-run-demo/.env`. Если устраивают параметры биндинга, то команда `make up` поднимет Laravel ( по умолчанию на http://127.8.0.1:8000 ).

### Прочее

В проекте используется базовые контейнер `php:8.4.7-fpm-bullseye`.

Для сборки golang-прилоржения — контейнер `golang:1.24.3-bullseye`.

Для сборки и выдачи фронтенда — `nginx:1.14.2-alpine` и `node:20.14.0-alpine3.19`

В `layers` закоммичены бинарники **ffi.so** и **runjs.so**, собранные для linux-amd64, на случай если кому-то будет лень собирать с нуля. Можно сразу сделать `make build-demo && make up`

На Mac и WSL не проверялось — могут быть неожиданности.

Зависимости golang завендорены и закоммичены т.к. их всего 11Мб. Завиимости laravel и node не закоммичены т.к. их уже 150Мб.

Команды для prod-сборки фронта не выведены из докер-контейнера т.к. это просто демка.
